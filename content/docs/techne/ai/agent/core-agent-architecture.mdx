---
title: 智能体核心架构
---

这一节是整个白皮书最关键的部分，我会用 工程视角、系统思维 和 架构级抽象 完整拆开三大组件：

> Model（大脑）
> Tools（手）
> Orchestration（神经系统）

注意：
这不是概念性总结，而是从“如何构建一个真正可运行的 Agent 系统”角度进行体系化拆解。

---

# Part 5 · Core Agent Architecture

（Agent 的核心架构：大脑、手、神经系统）

一个真正的 Agent，不是一个“加了工具的 LLM”，而是一个具备 推理能力 + 行动能力 + 状态管理 + 记忆 + 调度系统 的软件实体。

文档把它拆成三个核心部分：
Model（推理）
Tools（行动）
Orchestration（编排）
构成一个循环系统（Think → Act → Observe）。

下面逐层深入。

---

# 5.1 Model — 大脑（Reasoning Engine）

白皮书强调：

> 模型的选择不是看基准测试，而是看它是否能完成“agentic fundamentals”（推理、工具使用、多步计划）。

换句话说：

- 它不是一个“生成器”
- 它是系统的“前额叶皮层（prefrontal cortex）”
- 它支撑策略、判断、抽象和行为选择

## 5.1.1 模型的核心职责

(1) 任务理解（Mission Parsing）
把人类输入转成结构化任务。

(2) 情境建模（Contextual Reasoning）
理解环境、工具、历史、观察结果。

(3) 计划生成（Task Planning）
制定 multi-step 任务图（plan graph）。

(4) 工具选择（Tool Routing）
理解哪个工具适合执行特定子目标。

(5) 错误解释与恢复（Error Interpretation）
当工具失败、信息不够时，给出新的路径。

(6) 判断任务是否完成（Completion Assessment）

这是模型在 Agent 中最重要的能力之一。

---

## 5.1.2 模型不是“越大越好”，而是“越适合越好”

白皮书指出两个关键误区：

### ❌ 误区 1：用最大模型当大脑

- 成本高
- 延迟长
- 调用次数多
- 没有必要

### ✔️ 正确做法：模型分工（Model Routing）

文档给出的思路：

- 用强模型做计划
- 用轻模型做分类、纠错、解析、结构化
- 用本地模型做隐私敏感分析
- 用多模态模型处理视频、音频

即一个 “team of specialists（模型团队）”，而不是一个“万能模型”。

---

## 5.1.3 模型与系统的关系：LLM 是“插件”，不是主体

主体是：

- Orchestrator
- Tools
- Memory
- Execution runtime
- Policies
- Monitoring
- State storage

模型是一个 被调用的推理组件。
这才是现代 Agent 的架构哲学。

---

# 5.2 Tools — 手（Action Layer）

白皮书给出的最重要观点：

> Tools 是 Agent 连接现实世界的唯一途径。
> 没有 Tools，就没有“行动”，也就没有 Agent。

工具包括：

- RAG / 向量检索
- 数据库读写（SQL / NL2SQL）
- 搜索 API
- 执行代码（Python sandbox）
- HTTP API（第三方应用）
- UI automation / browser automation
- Human-in-the-loop（停下来问人）

工具的设计决定了 Agent 的“身体能力上限”。

---

## 5.2.1 Tool 的本质是一种“可调用的 deterministic function”

一个工具必须是：

1. 确定性的（deterministic）
   一次输入、多次调用必须结果一致。

2. 结构清晰的（schema-defined）
   参数、结果必须固定 schema。

3. 可验证/可拒绝的（guardrail-ready）
   当模型生成错参数时，可以拒绝执行。

4. 有明确错误类型的（error-typed）
   允许 Agent 推理错误原因并调整策略。

5. 可记录可追踪（traceable）

---

## 5.2.2 Tools 分三大类

### (1) 信息检索工具（Retrieval Tools）

来自白皮书：

> 给 Agent 提供“现实世界的事实”。

包括：

- RAG
- 文档搜索
- 数据仓库
- 结构化数据库
- 第三方 API
- Search Engine

---

### (2) 动作工具（Action Tools）

真正改变外部世界：

- 发邮件、发消息
- 创建用户、创建工单
- 更改数据库
- 执行交易
- 调度资源
- 控制浏览器
- 上传文件

这是 Agent 的“能量来源”。

---

### (3) 代码执行工具（Code Execution）

白皮书强调这是最强的一类工具：

> “在安全沙箱中执行任意代码，使 Agent 能够动态创造自己的能力。”

例如：

- 自动写正则
- 自动写 SQL
- 自动生成图表
- 自动进行数据处理
- 自动生成一个小函数来完成复杂逻辑

这是未来 Level 4 “自进化 Agent” 的基础。

---

# 5.3 Orchestration — 神经系统（控制层）

这是本节的核心。
白皮书明确说：

> Orchestration Layer 是整个 Agent 的真实“工程核心”。

它的职责比大多数人想象得更多，它不仅是“控制流程”，它是：

- 认知循环管理者
- 状态管理员
- 工具调用的仲裁者
- 记忆系统
- 策略执行器
- 安全边界
- 任务调度系统
- 多 Agent 协作协调器

---

# 5.3.1 Orchestrator 的关键能力

我会按工程逻辑拆成 10 项：

---

## (1) Context Engineering（上下文构建）

白皮书强调：

> “Agent 是管理 context 的系统。”

意思是：
关键不是 prompt 写得多好，而是：

- 哪些信息要给模型
- 以什么形式给
- 以什么顺序给
- 给多少
- 什么时候更新
- 什么时候移除
- 工具结果怎么嵌入

这是 Agent 能否保持“专注”与“正确性”的关键。

---

## (2) Loop Management（循环管理）

核心循环：

```
Think → Act → Observe → (Memory) → Think → ...
```

Orchestrator 必须解决：

- 什么时候该 Think
- 什么时候该 Act
- 什么叫“观察到足够信息”
- 什么时候循环应该结束

---

## (3) State Management（任务状态）

每次 Action 和 Observation 都会写入：

- 当前任务状态
- 对话状态
- 全局上下文
- 临时变量

这是系统不是“一问一答”，而是“持续任务”的基础。

---

## (4) Memory（短期与长期）

白皮书内部有专门一整节讲 Memory（后面会展开），但在这里要理解：

Memory 不是一个向量库，而是一个特定的系统模块，用来监督“信息在循环中的生命周期”。

包括：

- 最近几轮的 action/observation
- 用户偏好
- 历史任务
- 文档知识
- 上下文压缩
- 长期存储（RAG）

---

## (5) Tool Routing（工具选择与执行）

包括：

- 为模型提供「工具目录」
- 解析模型输出的 function call 信息
- 参数验证
- 错误处理
- 责任隔离（不要让模型直接发 HTTP）

---

## (6) Error Handling（错误恢复）

错误种类包括：

- 参数错误
- 工具不可用
- 外部 API 超时
- 权限拒绝
- 数据不存在

Orchestrator 负责：

- 截断错误
- 分类
- 回给模型解释
- 引导模型自我修正

---

## (7) Safety & Policy Enforcement（安全与策略）

包括：

- prompt injection 防御
- 工具权限限制
- 最大调用次数
- 最大成本控制
- 风险操作需要 HITL
- 输出过滤
- 输入过滤

---

## (8) Task Graph（任务动态图）管理

Level 2 的单体 Agent 是线性的，
Level 3 是任务图（graph）。

Orchestrator 能够：

- 创建子任务
- 调度子 Agent
- 合并结果
- 管理并发
- 回收资源

---

## (9) Termination Condition（终止条件）

Agent 不应该无限循环，需要：

- 模型判断任务是否完成
- Orchestrator 提供强制停止条件：
  - 最大步数
  - 超过成本
  - 超时
  - 意外状态

---

## (10) Observability（可观测性）

包括：

- traces（模型输入/输出、工具调用、状态变化）
- metrics（latency、cost、success rate）
- logs（工具执行日志）

这是 Agent Ops 的基础。

---

# 5.4 三者关系：谁是核心？

白皮书的核心观点是：

> 模型不是主角，Orchestration 才是主角。
> 模型与工具只是 Orchestrator 管理的子模块。

三者的关系是：

- Model = 决策器
- Tools = 执行器
- Orchestrator = 大脑皮层 + 神经系统（真正的 Agent）

如果你把 Orchestrator 设计得强，换什么模型都能跑。
但如果 Orchestrator 弱，用再强的模型也只是聊天机器人。

---

# 5.5 小结：Agent 架构的本质

如果把这一节浓缩成一句话：

> Agent = LLM × Tools × Orchestration
> → 通过循环（Loop）运行
> → 通过记忆（Memory）自持久
> → 通过结构（Task Graph）协作
> → 通过策略（Policy）安全
> → 通过可观测性（Telemetry）可控

LLM 是启智的引擎，
Tools 是行动的身体，
Orchestrator 是连接它们的神经系统。

三者缺一不可，而真正决定“智能体系统上限”的，是 orchestrator 的能力。

---
